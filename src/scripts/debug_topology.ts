
import * as turf from '@turf/turf';

const coordsRaw = "424318.7882266268 4216967.540538641 424318.7885605246 4216967.5436098315 424319.8274229439 4216977.081120573 424322.18727231957 4216984.779645581 424324.62449380476 4216992.78765903 424343.2324864045 4217070.159769643 424343.9600000037 4217075.630000003 424343.96200000215 4217075.634 424346.93400000036 4217075.762 424354.5999999996 4217076.092000008 424360.6103227632 4217075.71480044 424369.10000000056 4217075.182000004 424385.7000000002 4217067.182000002 424476.660000002 4217023.3325 424501.63000000175 4217019.462500004 424576.2505000001 4217015.381999997 424640.0110000018 4217013.462000003 424722.7315000016 4217010.962000003 424723.4315000018 4217010.971999999 424743.2615 4217011.371500002 424807.88150000107 4216987.842000002 424826.24149999954 4216983.761499999 424842.1615000013 4216983.6415 424867.382000003 4216983.371500002 424884.29200000037 4216982.631500006 424895.55200000294 4216986.3815 424908.052000002 4216992.7315000035 424916.0625 4216999.751000004 424925.222500002 4217010.2610000055 424932.7825000016 4217020.901000002 424940.58300000057 4217040.870500006 424944.5530000003 4217052.8505000025 424949.15350000095 4217067.180500001 424949.27350000106 4217067.550000003 424953.4135000007 4217076.830000002 424958.6635000007 4217080.360000001 424967.4035000019 4217082.650000002 424976.2134999996 4217082.420000002 424997.66400000267 4217077.290000001 425022.47400000226 4217067.180000002 425039.55399999954 4217060.2200000025 425096.154000001 4217035.120000005 425121.73400000203 4217034.740000002 425130.74400000274 4217033.190000005 425176.70400000084 4217020.280000003 425252.38450000156 4216996.950000003 425259.24450000003 4216995.120000003 425306.25450000167 4216980.490000004 425355.09449999966 4216966.500000006 425408.78450000286 4216951.120000005 425452.81450000126 4216938.570000004 425456.8445000015 4216936.18 425464.21450000256 4216933.190000003 425495.7145000035 4216921.930000003 425504.4145000009 4216916.690000003 425528.9645000007 4216904.110000001 425541.27450000215 4216895.3500000015 425573.0040000016 4216877.270000001 425576.9040000001 4216875.270000003 425582.574 4216871.120000007 425610.0039999997 4216860.920000004 425615.694000002 4216858.969999999 425620.2840000009 4216858.320000004 425655.7340000002 4216851.610000005 425660.10400000215 4216849.370000001 425669.7940000007 4216847.230000002 425719.89450000133 4216841.280000005 425729.034500001 4216840.480000006 425730.7945000008 4216840.440000003 425762.10450000037 4216836.4495 425766.89450000133 4216835.869500004 425771.63450000156 4216835.129500002 425781.364500002 4216830.3795000035 425788.2945000008 4216826.339500001 425793.24450000096 4216821.759500004 425818.3540000003 4216800.5 425825.6640000036 4216794.630000003 425864.67399999965 4216762.170000002 425867.36400000285 4216758.320000002 425768.16350000165 4216742.480999999 425674.54300000146 4216727.751500001 425644.5125000011 4216728.061500004 425594.18150000274 4216634.563000005 425578.32100000046 4216587.774000002 425560.4704999998 4216556.624000004 425543.13000000175 4216540.274500003 425520.3700000001 4216523.9250000045 425558.8195000021 4216464.155500004 425565.5590000022 4216445.4155 425573.0790000027 4216435.965500005 425574.8990000002 4216426.826000003 425559.5854000021 4216427.782550007 425558.2362000011 4216430.215450004 425501.70005000103 4216433.814750001 425501.1219000006 4216433.851550002 425432.1235000007 4216434.626400003 425372.7703 4216435.292950004 425365.1466500014 4216435.378550006 425305.0800500028 4216436.053050004 425298.3017500024 4216436.129200002 425284.257650001 4216437.523400001 425265.87620000076 4216439.348150002 425255.382650001 4216440.389849998 425230.01805000287 4216442.907800006 425070.7162500005 4216465.084050005 424976.62574999966 4216469.04315 424970.4169500023 4216477.869150007 424948.6860000016 4216500.769100005 424920.3764000004 4216526.8253000025 424876.6198500013 4216567.3802000005 424778.3110000007 4216632.714400003 424660.34040000197 4216677.606650006 424595.0618500002 4216614.7115 424552.29780000076 4216573.508900002 424551.5049999999 4216575.418 424551.0150000006 4216576.598000005 424539.93500000145 4216592.828 424494.66500000097 4216590.868000003 424488.7150000017 4216594.668000003 424452.5150000015 4216611.158 424443.16449999996 4216608.278000003 424427.0645000003 4216602.588000001 424406.8545000022 4216630.788000001 424255.3565000016 4216836.7255000025 424219.4165000031 4216884.735000007 424224.4670000011 4216888.085000005 424231.94700000156 4216888.945000002 424232.99700000044 4216888.725000007 424233.3270000005 4216888.655000003 424240.9670000011 4216887.045000004 424241.6870000018 4216886.895000001 424245.8969999999 4216885.815000003 424246.1270000022 4216885.775000008 424250.6116893925 4216884.982054925 424250.2025968479 4216881.113979604 424262.49825244024 4216879.87085266 424272.352858766 4216878.898953421 424282.2300673956 4216877.972258791 424290.81894446444 4216877.045564156 424300.5153346257 4216874.51410565 424301.9859317178 4216880.018426402 424302.0974961901 4216880.43591037 424303.21266067587 4216899.648601338 424303.6796577573 4216907.694293909 424310.6749356976 4216925.292022506 424315.20683487784 4216936.693055173 424317.4218610665 4216948.062016137 424319.34305725247 4216957.374167059 424318.61978339776 4216966.1212602835 424318.7882266268 4216967.540538641 424318.7882266268 4216967.540538641";

function runDebug() {
    const rawList = coordsRaw.split(' ').map(Number);
    const points: number[][] = [];
    for (let i = 0; i < rawList.length; i += 2) {
        points.push([rawList[i], rawList[i + 1]]);
    }

    console.log(`Puntos originales: ${points.length}`);

    // Crear Polígono "Naive" (orden original)
    const naivePoly = turf.polygon([points]);
    const naiveKinks = turf.kinks(naivePoly);
    console.log(`Kinks (Original): ${naiveKinks.features.length}`);
    naiveKinks.features.forEach((kink, i) => {
        if (i < 5) console.log(`  Kink ${i}:`, kink.geometry.coordinates);
    });

    if (naiveKinks.features.length > 0) {
        // Run TSP Algo
        console.log("--- Running TSP Fix ---");
        const uniquePoints = points.slice(0, points.length - 1);
        const sortedPoints = [uniquePoints[0]];
        const remaining = uniquePoints.slice(1);

        while (remaining.length > 0) {
            const last = sortedPoints[sortedPoints.length - 1];
            let nearestIdx = -1;
            let minDist = Infinity;

            for (let i = 0; i < remaining.length; i++) {
                const d = (remaining[i][0] - last[0]) ** 2 + (remaining[i][1] - last[1]) ** 2;
                if (d < minDist) {
                    minDist = d;
                    nearestIdx = i;
                }
            }

            if (nearestIdx !== -1) {
                sortedPoints.push(remaining[nearestIdx]);
                remaining.splice(nearestIdx, 1);
            } else {
                break;
            }
        }
        sortedPoints.push(sortedPoints[0]);

        const tspPoly = turf.polygon([sortedPoints]);
        const tspKinks = turf.kinks(tspPoly);
        console.log(`Kinks after TSP: ${tspKinks.features.length}`);
    } else {
        console.log("El polígono original NO tiene kinks. El problema es otro.");
    }
}

runDebug();
